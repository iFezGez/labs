
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Technical Lab Documentation – Virtualization, Storage, VPN, Containers, Monitoring">
      
      
        <meta name="author" content="Ignacio Fernandez">
      
      
        <link rel="canonical" href="https://docs.vestasec.com/network/">
      
      
        <link rel="prev" href="../troubleshooting/">
      
      
        <link rel="next" href="../virtualization/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Network - Vesta Lab Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mikrotik-vlan-routing-configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Vesta Lab Documentation" class="md-header__button md-logo" aria-label="Vesta Lab Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vesta Lab Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Network
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/vestasec/vesta-lab" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    vestasec/vesta-lab
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../architecture/" class="md-tabs__link">
          
  
  
  Lab Setup

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Modules

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../credits/" class="md-tabs__link">
        
  
  
    
  
  Credits

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Vesta Lab Documentation" class="md-nav__button md-logo" aria-label="Vesta Lab Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Vesta Lab Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vestasec/vesta-lab" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    vestasec/vesta-lab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Lab Setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Lab Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Network
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Network
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#router-model" class="md-nav__link">
    <span class="md-ellipsis">
      Router Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interfaces-and-bridge" class="md-nav__link">
    <span class="md-ellipsis">
      Interfaces and Bridge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vlans-defined" class="md-nav__link">
    <span class="md-ellipsis">
      VLANs Defined
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dhcp-server-per-vlan" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP Server per VLAN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-routes" class="md-nav__link">
    <span class="md-ellipsis">
      Static Routes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nat-firewall" class="md-nav__link">
    <span class="md-ellipsis">
      ️ NAT &amp; Firewall
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration File
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../virtualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Containers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal_apps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal Apps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backups
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../credits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credits
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#router-model" class="md-nav__link">
    <span class="md-ellipsis">
      Router Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interfaces-and-bridge" class="md-nav__link">
    <span class="md-ellipsis">
      Interfaces and Bridge
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vlans-defined" class="md-nav__link">
    <span class="md-ellipsis">
      VLANs Defined
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dhcp-server-per-vlan" class="md-nav__link">
    <span class="md-ellipsis">
      DHCP Server per VLAN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-routes" class="md-nav__link">
    <span class="md-ellipsis">
      Static Routes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nat-firewall" class="md-nav__link">
    <span class="md-ellipsis">
      ️ NAT &amp; Firewall
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration File
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mikrotik-vlan-routing-configuration">MikroTik VLAN &amp; Routing Configuration<a class="headerlink" href="#mikrotik-vlan-routing-configuration" title="Permanent link">&para;</a></h1>
<h2 id="router-model">Router Model<a class="headerlink" href="#router-model" title="Permanent link">&para;</a></h2>
<ul>
<li>MikroTik hEX RB750Gr3</li>
<li>RouterOS v7+</li>
<li>Access: WinBox, WebFig, SSH</li>
</ul>
<h2 id="interfaces-and-bridge">Interfaces and Bridge<a class="headerlink" href="#interfaces-and-bridge" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>ether1: WAN uplink
ether2-ether5: LAN / trunk ports
bridge: main bridge with VLAN awareness
</code></pre></div>
<h2 id="vlans-defined">VLANs Defined<a class="headerlink" href="#vlans-defined" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>VLAN</th>
<th>Name</th>
<th>Subnet</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>mgmt</td>
<td>10.10.0.0/24</td>
<td>Proxmox nodes</td>
</tr>
<tr>
<td>20</td>
<td>services</td>
<td>10.20.0.0/24</td>
<td>Docker, NPM</td>
</tr>
<tr>
<td>30</td>
<td>storage</td>
<td>10.30.0.0/24</td>
<td>PBS, TrueNAS</td>
</tr>
<tr>
<td>40</td>
<td>iot</td>
<td>10.40.0.0/24</td>
<td>IoT devices</td>
</tr>
<tr>
<td>50</td>
<td>guest</td>
<td>10.50.0.0/24</td>
<td>Guest clients</td>
</tr>
</tbody>
</table>
<h2 id="dhcp-server-per-vlan">DHCP Server per VLAN<a class="headerlink" href="#dhcp-server-per-vlan" title="Permanent link">&para;</a></h2>
<p>Each VLAN has its own DHCP server and IP pool.</p>
<h2 id="static-routes">Static Routes<a class="headerlink" href="#static-routes" title="Permanent link">&para;</a></h2>
<p>The MikroTik routes between VLANs and acts as the default gateway for all subnets.</p>
<h2 id="nat-firewall">️ NAT &amp; Firewall<a class="headerlink" href="#nat-firewall" title="Permanent link">&para;</a></h2>
<ul>
<li>NAT rule: masquerade for all outbound traffic via WAN</li>
<li>Firewall: default drop + accepted rules per interface/vlan</li>
</ul>
<h2 id="configuration-file">Configuration File<a class="headerlink" href="#configuration-file" title="Permanent link">&para;</a></h2>
<p>See <code>mikrotik/config_files/full_config.rsc</code> for the exported configuration of the lab router.</p>
<hr />
<h1 id="vpn-gateway-tailscale-setup-docker-ve2">VPN Gateway – Tailscale Setup (docker-ve2)<a class="headerlink" href="#vpn-gateway-tailscale-setup-docker-ve2" title="Permanent link">&para;</a></h1>
<p>This VPN Gateway provides secure remote access to all services in the Vesta Lab via Tailscale.</p>
<hr />
<h2 id="infrastructure">Infrastructure<a class="headerlink" href="#infrastructure" title="Permanent link">&para;</a></h2>
<ul>
<li>Hostname: <code>vpn-gateway</code></li>
<li>Location: Docker container on <code>docker-ve2</code></li>
<li>IP: <code>10.20.0.3</code></li>
<li>VLAN: 20 (services)</li>
<li>ACL Tag: <code>tag:docker</code></li>
<li>Auth: Pre-authorized <code>TS_AUTHKEY</code></li>
</ul>
<hr />
<h2 id="docker-deployment">Docker Deployment<a class="headerlink" href="#docker-deployment" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="o">=</span>tailscale<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cap-add<span class="o">=</span>NET_ADMIN<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--device<span class="o">=</span>/dev/net/tun<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span><span class="nv">TS_AUTHKEY</span><span class="o">=</span><span class="s2">&quot;tskey-...&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span><span class="nv">TS_ROUTES</span><span class="o">=</span><span class="s2">&quot;10.0.0.0/8&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span><span class="nv">TS_EXTRA_ARGS</span><span class="o">=</span><span class="s2">&quot;--advertise-tags=tag:docker&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>tailscale_data:/var/lib/tailscale<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--restart<span class="o">=</span>always<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>tailscale/tailscale
</code></pre></div>
<blockquote>
<p>Replace <code>tskey-...</code> with your pre-authorized key from the Tailscale admin console.</p>
</blockquote>
<hr />
<h2 id="acl-configuration">ACL Configuration<a class="headerlink" href="#acl-configuration" title="Permanent link">&para;</a></h2>
<p>ACLs are managed via the Tailscale admin panel:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;groups&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;group:admin&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;info@vestasec.com&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;tagOwners&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;tag:docker&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;autogroup:admin&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;acls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;accept&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;src&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;dst&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*:*&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>This setup allows full unrestricted access from any approved client to any subnet, including internal lab services.</p>
<hr />
<h2 id="verification">Verification<a class="headerlink" href="#verification" title="Permanent link">&para;</a></h2>
<ul>
<li>Access <code>vpn-gateway</code> from Tailscale Console</li>
<li>Ensure it shows <code>tag:docker</code> and status "Active"</li>
<li>Confirm route advertisement covers lab subnets</li>
</ul>
<h2 id="result">Result<a class="headerlink" href="#result" title="Permanent link">&para;</a></h2>
<p>Remote access to the full lab infrastructure via Tailscale is now secure and available across devices.</p>
<hr />
<h1 id="vesta-lab-vlan-configuration">Vesta Lab – VLAN Configuration<a class="headerlink" href="#vesta-lab-vlan-configuration" title="Permanent link">&para;</a></h1>
<p>VLANs are used in the Vesta Lab to separate network traffic logically and securely. All VLANs are trunked through the MikroTik router and tagged appropriately on Proxmox bridges and VM interfaces.</p>
<hr />
<h2 id="vlan-table">VLAN Table<a class="headerlink" href="#vlan-table" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>VLAN ID</th>
<th>Name</th>
<th>Subnet</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>mgmt</td>
<td>10.10.0.0/24</td>
<td>Proxmox VE, monitoring</td>
</tr>
<tr>
<td>20</td>
<td>services</td>
<td>10.20.0.0/24</td>
<td>Docker, Portainer, NPM</td>
</tr>
<tr>
<td>30</td>
<td>storage</td>
<td>10.30.0.0/24</td>
<td>PBS, TrueNAS, NFS</td>
</tr>
<tr>
<td>40</td>
<td>iot</td>
<td>10.40.0.0/24</td>
<td>Future IoT devices</td>
</tr>
<tr>
<td>50</td>
<td>guest</td>
<td>10.50.0.0/24</td>
<td>Guest WiFi, external users</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="trunk-configuration-proxmox">Trunk Configuration (Proxmox)<a class="headerlink" href="#trunk-configuration-proxmox" title="Permanent link">&para;</a></h2>
<p>Bridge <code>vmbr0</code> on each Proxmox node includes VLAN awareness:</p>
<div class="highlight"><pre><span></span><code>bridge-vlan-aware<span class="w"> </span>yes
bridge-vids<span class="w"> </span><span class="m">2</span>-4094
</code></pre></div>
<p>Each VM or container is assigned a VLAN tag using <code>vmbr0.X</code>, for example:</p>
<div class="highlight"><pre><span></span><code>auto<span class="w"> </span>vmbr0.10
iface<span class="w"> </span>vmbr0.10<span class="w"> </span>inet<span class="w"> </span>static
<span class="w">  </span>address<span class="w"> </span><span class="m">10</span>.10.0.2/24
<span class="w">  </span>gateway<span class="w"> </span><span class="m">10</span>.10.0.1
</code></pre></div>
<hr />
<h2 id="mikrotik-port-configuration">MikroTik Port Configuration<a class="headerlink" href="#mikrotik-port-configuration" title="Permanent link">&para;</a></h2>
<ul>
<li>ether1: WAN</li>
<li>ether2–ether5: trunk ports to Proxmox nodes and switches</li>
<li>Bridge interface carries all VLANs</li>
<li>DHCP servers per VLAN</li>
</ul>
<hr />
<h2 id="benefits">Benefits<a class="headerlink" href="#benefits" title="Permanent link">&para;</a></h2>
<ul>
<li>Isolation between infrastructure layers</li>
<li>Reduced broadcast domain</li>
<li>Improved security posture</li>
<li>Simplified firewall rule logic</li>
</ul>
<h2 id="result_1">Result<a class="headerlink" href="#result_1" title="Permanent link">&para;</a></h2>
<p>All core services operate in isolated VLANs with centralized routing, DHCP and firewalling via MikroTik.</p>
<hr />
<h1 id="mikrotik-firewall-nat-configuration-vesta-lab">MikroTik Firewall &amp; NAT Configuration – Vesta Lab<a class="headerlink" href="#mikrotik-firewall-nat-configuration-vesta-lab" title="Permanent link">&para;</a></h1>
<p>The following rules and NAT configuration are used to secure the lab while allowing functional access between VLANs and out to the Internet.</p>
<hr />
<h2 id="default-policy">Default Policy<a class="headerlink" href="#default-policy" title="Permanent link">&para;</a></h2>
<ul>
<li>Input Chain: Drop all unless explicitly allowed</li>
<li>Forward Chain: Accept all inter-VLAN unless filtered</li>
<li>Output Chain: Accept</li>
</ul>
<hr />
<h2 id="nat-rules">NAT Rules<a class="headerlink" href="#nat-rules" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>/ip firewall nat
add chain=srcnat out-interface=ether1 action=masquerade comment=&quot;NAT for WAN access&quot;
</code></pre></div>
<blockquote>
<p>This rule enables Internet access for all VLANs through the main WAN interface (ether1).</p>
</blockquote>
<hr />
<h2 id="input-chain-rules">Input Chain Rules<a class="headerlink" href="#input-chain-rules" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>/ip firewall filter
add chain=input action=accept connection-state=established,related comment=&quot;Allow established&quot;
add chain=input action=accept protocol=icmp comment=&quot;Allow ICMP&quot;
add chain=input action=accept in-interface=bridge src-address=10.10.0.0/24 comment=&quot;Allow mgmt subnet&quot;
add chain=input action=drop comment=&quot;Drop all else&quot;
</code></pre></div>
<hr />
<h2 id="forwarding-inter-vlan-traffic">Forwarding &amp; Inter-VLAN Traffic<a class="headerlink" href="#forwarding-inter-vlan-traffic" title="Permanent link">&para;</a></h2>
<p>All VLANs are allowed to route between each other by default. This can be restricted further per use case using additional forward chain filters.</p>
<blockquote>
<p>Example: block IoT (VLAN 40) from accessing mgmt (VLAN 10):
<div class="highlight"><pre><span></span><code>add chain=forward action=drop src-address=10.40.0.0/24 dst-address=10.10.0.0/24
</code></pre></div></p>
</blockquote>
<hr />
<h2 id="security-notes">️ Security Notes<a class="headerlink" href="#security-notes" title="Permanent link">&para;</a></h2>
<ul>
<li>WinBox and SSH are only allowed from the management VLAN (10.10.0.0/24)</li>
<li>Remote admin interfaces should be disabled on guest-facing VLANs</li>
<li>Service ports (UPnP, DNS, FTP) are disabled by default</li>
</ul>
<hr />
<h2 id="result_2">Result<a class="headerlink" href="#result_2" title="Permanent link">&para;</a></h2>
<p>A hardened firewall configuration that protects the router and core lab infrastructure while enabling controlled inter-VLAN communication and Internet access.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>